# ğŸ“ Projectstructuur: my-medusa-store

Dit project is een monorepo waarin we zowel de Medusa backend als de volledige custom Next.js frontend voor Wasgeurtje.nl onderhouden. 
Het doel is om de volledige e-commerce beleving van https://wasgeurtje.nl na te bouwen, met integratie van Medusa als headless backend en een pixel-perfect Next.js frontend. De backend beheert alle bedrijfslogica zoals producten, orders, loyaliteitsprogrammaâ€™s en voorraadbeheer. De frontend dient als representatieve, conversie-geoptimaliseerde webshop gekoppeld aan de backend.

## âœ… Doel van het project

- Volledige rebuild van Wasgeurtje.nl in een modern headless stack
- Backend: Medusa (gehost op Render & lokaal), beheert businesslogica, extensies, workflows en REST API's
- Frontend: Next.js 14 (App Router) met Supabase Auth SSR ondersteuning (bijv. voor loyalty/mijn account, gepersonaliseerd shoppen)
- API-integratie via `@medusajs/medusa-js` (op de frontend)
- Pixel-perfect, elegant en conversiegericht design gebaseerd op https://wasgeurtje.nl
- Futureproof architectuur, geschikt voor composable commerce / JAMstack-principes

---

## ğŸ“ Backend structuur (Medusa)

```
my-medusa-store/
â”œâ”€â”€ src/                         # Medusa backendlogica
â”‚   â”œâ”€â”€ admin/                   # Admin-routes en panels
â”‚   â”œâ”€â”€ api/                     # REST API-routes (store/admin)
â”‚   â”œâ”€â”€ jobs/                    # Periodieke jobs, background tasks
â”‚   â”œâ”€â”€ links/                   # Relationele links tussen modules
â”‚   â”œâ”€â”€ modules/                 # Medusa-modules en services (ProductService, OrderService etc.)
â”‚   â”œâ”€â”€ scripts/                 # Seed, integratie scripts, utilities
â”‚   â”œâ”€â”€ subscribers/             # Event-driven handlers (bijv. na order geplaatst)
â”‚   â””â”€â”€ workflows/               # Custom workflows (order flow, loyalty flow etc.)
â”‚
â”œâ”€â”€ integration-tests/          # Backend-integratietests
â”œâ”€â”€ medusa-config.ts            # Projectconfiguratie incl. database, Redis, plugins, poortinstelling
â”œâ”€â”€ .env                        # Gevoelige configuratie: DATABASE_URL, REDIS_URL, API_KEYS
â”œâ”€â”€ .env.template               # Template voor nieuwe devs / staging
â”œâ”€â”€ package.json                # Backend dependencies
â”œâ”€â”€ yarn.lock                   # Dependency lock
â”œâ”€â”€ tsconfig.json               # Typescript configuratie
â””â”€â”€ ...                         # Jest config, logging tools, CLI scripts
```

### ğŸŒ Voorbeeld API:
- `http://localhost:9000/store/products` â†’ Openbare productdata (frontend gebruikt deze)
- `http://localhost:9000/admin/orders` â†’ Beheerderslogica (afgeschermd via API key/token)

Medusa draait lokaal op poort `9000` en is gekoppeld aan je lokale PostgreSQL database + Redis instance. Hosting via Render is mogelijk.

---

## ğŸ“ Frontend structuur (Next.js 14)

```
frontend/
â”œâ”€â”€ app/                         # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx              # Algemene layout (header/footer)
â”‚   â”œâ”€â”€ page.tsx                # Homepage
â”‚   â”œâ”€â”€ producten/              # Product overzichtspagina
â”‚   â”‚   â””â”€â”€ [handle]/page.tsx   # Dynamische product detailpagina
â”‚   â”œâ”€â”€ categorieen/            # Gecategoriseerde collecties (Premium, Best verkocht, etc.)
â”‚   â”œâ”€â”€ winkelwagen/page.tsx    # Cart functionaliteit
â”‚   â”œâ”€â”€ afrekenen/page.tsx      # Checkout (incl. adres, betaalmethodes)
â”‚   â”œâ”€â”€ login/page.tsx          # Supabase login/registratie
â”‚   â””â”€â”€ account/page.tsx        # Mijn account, bestellingen etc.
â”‚
â”œâ”€â”€ components/                # Herbruikbare visuele componenten
â”‚   â”œâ”€â”€ ui/                    # Buttons, forms, modals, etc.
â”‚   â”œâ”€â”€ layout/                # Header, Footer, Grid-structuren
â”‚   â””â”€â”€ product/               # ProductCard, QuantitySelector, PrijsLabel etc.
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ medusa.ts               # API-client voor frontend (@medusajs/medusa-js)
â”‚   â”œâ”€â”€ supabase/               # Supabase SSR clients (client.ts/server.ts)
â”‚
â”œâ”€â”€ middleware.ts              # Supabase-auth middleware (cookie sync)
â”œâ”€â”€ public/                    # Afbeeldingen, icons, favicons
â”œâ”€â”€ styles/                    # Tailwind config, custom SCSS
â”œâ”€â”€ .env.local                 # NEXT_PUBLIC_ vars incl. backend URL
â”œâ”€â”€ tailwind.config.js         # Tailwind configuratie
â”œâ”€â”€ postcss.config.js
â””â”€â”€ tsconfig.json              # Typescript config
```

---

## â— Strenge ontwikkelregels (voor AI, devs en code reviews)

1. âŒ Maak **nooit** dubbele utility functies aan â€” gebruik helpers in `lib/`
2. âœ… Gebruik uitsluitend `@supabase/ssr`, nooit `auth-helpers-nextjs`
3. âœ… Cookie handling alleen via `getAll()` en `setAll()` (nooit `get`, `set`, `remove`)
4. âœ… Gebruik `createBrowserClient()` en `createServerClient()` exact zoals gespecificeerd in `.cursorrule`
5. âœ… Hergebruik componenten: bijv. `ProductCard.tsx` voor homepage Ã©n zoekresultaten
6. âœ… Gebruik `layout.tsx` (uit `app/`) voor paginawraps en consistentie
7. âœ… Backend-communicatie via `medusa.ts`, nooit inline fetch() calls met hardcoded URLs

---

## ğŸ“˜ README.md (voorstel inhoud)

```markdown
# Wasgeurtje Headless Webshop

Wasgeurtje is een moderne headless webshop gebaseerd op Medusa.js en Next.js. 
Deze repo combineert backend (Medusa) en frontend (Next.js 14) in Ã©Ã©n monorepo voor eenvoudig beheer en samenwerking.

## ğŸ“¦ Stackoverzicht
- **Backend**: Medusa.js, PostgreSQL, Redis
- **Frontend**: Next.js, TypeScript, TailwindCSS
- **Auth**: Supabase (SSR + Middleware + session sync)
- **Hosting**: Render + Vercel (optioneel Netlify)

## ğŸ—‚ï¸ Projectstructuur
- `src/` + `medusa-config.ts`: backendlogica (Medusa)
- `frontend/`: Next.js webshop en customer facing UI

## ğŸ› ï¸ Ontwikkelen

```bash
cd frontend
npm run dev
```

Zorg dat je backend lokaal draait op `http://localhost:9000`

```bash
cd .. && npm run dev
```

## ğŸ” Supabase Auth
- SSR client: `lib/supabase/server.ts`
- Browser client: `lib/supabase/client.ts`
- Middleware: `middleware.ts` (volgt `getAll()` / `setAll()` cookiepatroon)

## ğŸ“š Documentatie
- [Supabase SSR setup](./lib/supabase/README.md)
- [Medusa backend docs](https://docs.medusajs.com)
- [.cursorrule richtlijnen](./.cursorrule)